from __future__ import unicode_literals
from __future__ import division
from __future__ import absolute_import
from future.builtins import str
__all__ = [
 b'encode_7or8bit',
 b'encode_base64',
 b'encode_noop',
 b'encode_quopri']
try:
    from base64 import encodebytes as _bencode
except ImportError:
    from base64 import encodestring as _bencode

from quopri import encodestring as _encodestring

def _qencode(s):
    enc = _encodestring(s, quotetabs=True)
    return enc.replace(b' ', b'=20')


def encode_base64(msg):
    orig = msg.get_payload()
    encdata = str(_bencode(orig), b'ascii')
    msg.set_payload(encdata)
    msg[b'Content-Transfer-Encoding'] = b'base64'


def encode_quopri(msg):
    orig = msg.get_payload()
    encdata = _qencode(orig)
    msg.set_payload(encdata)
    msg[b'Content-Transfer-Encoding'] = b'quoted-printable'


def encode_7or8bit(msg):
    orig = msg.get_payload()
    if orig is None:
        msg[b'Content-Transfer-Encoding'] = b'7bit'
        return
    else:
        try:
            if isinstance(orig, str):
                orig.encode(b'ascii')
            else:
                orig.decode(b'ascii')
        except UnicodeError:
            charset = msg.get_charset()
            output_cset = charset and charset.output_charset
            if output_cset and output_cset.lower().startswith(b'iso-2022-'):
                msg[b'Content-Transfer-Encoding'] = b'7bit'
            else:
                msg[b'Content-Transfer-Encoding'] = b'8bit'
        else:
            msg[b'Content-Transfer-Encoding'] = b'7bit'

        if not isinstance(orig, str):
            msg.set_payload(orig.decode(b'ascii', b'surrogateescape'))
        return


def encode_noop(msg):
    orig = msg.get_payload()
    if not isinstance(orig, str):
        msg.set_payload(orig.decode(b'ascii', b'surrogateescape'))